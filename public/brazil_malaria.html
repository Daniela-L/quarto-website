<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniela Luhrsen, Rachel Lowe and Raquel Lana">
<meta name="dcterms.date" content="2022-11-18">

<title>Malaria in Brazil – data4health</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/harmonize_logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">data4health</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-instructions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Instructions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-instructions">    
        <li class="dropdown-header">Brazil</li>
        <li>
    <a class="dropdown-item" href="./brazil_download_data.html">
 <span class="dropdown-text">Download data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./brazil_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./brazil_malaria.html">
 <span class="dropdown-text">Malaria</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Colombia</li>
        <li>
    <a class="dropdown-item" href="./colombia_lepto.qmd">
 <span class="dropdown-text">Leptospirosis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./colombia_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Dominican Republic</li>
        <li>
    <a class="dropdown-item" href="./domrep_malaria.html">
 <span class="dropdown-text">Malaria</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./domrep_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Peru</li>
        <li>
    <a class="dropdown-item" href="./peru_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reports" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reports</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reports">    
        <li class="dropdown-header">Brazil</li>
        <li>
    <a class="dropdown-item" href="./brazil_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./brazil_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Colombia</li>
        <li>
    <a class="dropdown-item" href="./colombia_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./colombia_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Dominican Republic</li>
        <li>
    <a class="dropdown-item" href="./domrep_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./domrep_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Peru</li>
        <li>
    <a class="dropdown-item" href="./peru_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./peru_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./ui_tool.html"> 
<span class="menu-text">No-coding tool</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./brazil.html">Brazil</a></li><li class="breadcrumb-item"><a href="./brazil_malaria.html">Malaria</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="1b4e9b07bc2c0b211b44cc4b05a9f2bf" class="alert alert-primary hidden"><i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>Alert</strong> - The person reading this announcement is very pretty.</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./brazil.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Brazil</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brazil_download_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brazil_dengue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brazil_malaria.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Malaria</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./colombia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colombia</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./colombia_lepto.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leptospirosis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./colombia_dengue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./domrep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dominican Republic</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./domrep_malaria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Malaria</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./domrep_dengue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./peru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Peru</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./peru_dengue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setting-up-the-r-environment" id="toc-setting-up-the-r-environment" class="nav-link active" data-scroll-target="#setting-up-the-r-environment">Setting up the R environment</a></li>
  <li><a href="#downloading-the-data" id="toc-downloading-the-data" class="nav-link" data-scroll-target="#downloading-the-data">Downloading the data</a></li>
  <li><a href="#getting-to-know-the-data" id="toc-getting-to-know-the-data" class="nav-link" data-scroll-target="#getting-to-know-the-data">Getting to know the Data</a>
  <ul class="collapse">
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables"><em>Variables</em></a></li>
  <li><a href="#completeness-of-the-data" id="toc-completeness-of-the-data" class="nav-link" data-scroll-target="#completeness-of-the-data"><em>Completeness of the data</em></a></li>
  </ul></li>
  <li><a href="#information-on-the-patients" id="toc-information-on-the-patients" class="nav-link" data-scroll-target="#information-on-the-patients">Information on the Patients</a>
  <ul class="collapse">
  <li><a href="#age-of-patients" id="toc-age-of-patients" class="nav-link" data-scroll-target="#age-of-patients"><em>Age of patients</em></a></li>
  <li><a href="#sex-of-the-patients" id="toc-sex-of-the-patients" class="nav-link" data-scroll-target="#sex-of-the-patients"><em>Sex of the patients</em></a></li>
  <li><a href="#pregnancy" id="toc-pregnancy" class="nav-link" data-scroll-target="#pregnancy"><em>Pregnancy</em></a></li>
  <li><a href="#race-of-the-patients" id="toc-race-of-the-patients" class="nav-link" data-scroll-target="#race-of-the-patients"><em>Race of the patients</em></a></li>
  </ul></li>
  <li><a href="#classifying-the-malaria-cases" id="toc-classifying-the-malaria-cases" class="nav-link" data-scroll-target="#classifying-the-malaria-cases">Classifying the malaria cases</a>
  <ul class="collapse">
  <li><a href="#type-of-detection" id="toc-type-of-detection" class="nav-link" data-scroll-target="#type-of-detection"><em>Type of detection</em></a></li>
  <li><a href="#symptoms" id="toc-symptoms" class="nav-link" data-scroll-target="#symptoms"><em>Symptoms</em></a></li>
  </ul></li>
  <li><a href="#timeline-of-malaria-cases" id="toc-timeline-of-malaria-cases" class="nav-link" data-scroll-target="#timeline-of-malaria-cases">Timeline of malaria cases</a>
  <ul class="collapse">
  <li><a href="#notification-distribution-throughout-the-year" id="toc-notification-distribution-throughout-the-year" class="nav-link" data-scroll-target="#notification-distribution-throughout-the-year"><em>Notification distribution throughout the year</em></a></li>
  <li><a href="#timeline-of-all-other-events" id="toc-timeline-of-all-other-events" class="nav-link" data-scroll-target="#timeline-of-all-other-events"><em>Timeline of all other events</em></a></li>
  </ul></li>
  <li><a href="#mapping-spatially" id="toc-mapping-spatially" class="nav-link" data-scroll-target="#mapping-spatially">Mapping spatially</a>
  <ul class="collapse">
  <li><a href="#notification-residence-probable-infection" id="toc-notification-residence-probable-infection" class="nav-link" data-scroll-target="#notification-residence-probable-infection"><em>Notification, Residence &amp; Probable Infection</em></a></li>
  <li><a href="#mapping-types-of-malaria" id="toc-mapping-types-of-malaria" class="nav-link" data-scroll-target="#mapping-types-of-malaria"><em>Mapping types of Malaria</em></a></li>
  <li><a href="#calculating-the-incidence" id="toc-calculating-the-incidence" class="nav-link" data-scroll-target="#calculating-the-incidence"><em>Calculating the incidence</em></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./brazil.html">Brazil</a></li><li class="breadcrumb-item"><a href="./brazil_malaria.html">Malaria</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Malaria in Brazil</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniela Luhrsen, Rachel Lowe and Raquel Lana </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 18, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This document aims at introducing SINAN malaria data to someone with no previous experience.</p>
<p>The steps include:</p>
<ol start="0" type="1">
<li>Downloading the data</li>
<li>Getting to know the data: variables and completeness</li>
<li>Information on the patients: Age, Sex, Pregnancy and Race</li>
<li>Classifying the malaria cases: detection and symptoms</li>
<li>Timeline of malaria cases: distribution throughout the year, and course of the cases</li>
<li>Mapping spatially: municipality types, malaria types and incidences</li>
</ol>
<p>Along the way, each topic will be divided into 3:</p>
<ul>
<li><p><img src="images/idea-02.png" class="img-fluid" width="25"> indicates that you will learn something</p></li>
<li><p><img src="images/eye-01.png" class="img-fluid" width="24"> indicates that you will see the data in a plot</p></li>
<li><p><img src="images/filter-01.png" class="img-fluid" width="20"> indicates that there is a opportunity to filter data (if necessary).</p></li>
</ul>
<section id="setting-up-the-r-environment" class="level1">
<h1>Setting up the R environment</h1>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> In every R script,</p>
<p>In this script we will need the following R-scripts:</p>
<ul>
<li><p>microdatasus: To download the health data from brazil</p></li>
<li><p>dplyr:</p></li>
<li><p>purrr:</p></li>
<li><p>ggplot2: to create the graphs</p></li>
<li><p>tidyr:</p></li>
<li><p>lubridate: to help format the dates</p></li>
<li><p>geobr: to download the shapefiles of brazils</p></li>
<li><p>stringr:</p></li>
</ul>
<p>Other options that are being set up now include, setting a maximum waiting time for functions (i.e.&nbsp;timeout), how large number should be displayed (i.e.&nbsp;scipen) and functions are locally loaded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>packages  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"microdatasus"</span>, <span class="st">"dplyr"</span>, <span class="st">"purrr"</span>, <span class="st">"ggplot2"</span>,<span class="st">"tidyr"</span>, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"lubridate"</span>,<span class="st">"geobr"</span>, <span class="st">"stringr"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">install.packages</span>(<span class="fu">setdiff</span>(packages, <span class="fu">rownames</span>(<span class="fu">installed.packages</span>()))))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(packages, <span class="cf">function</span>(pkg) <span class="fu">suppressMessages</span>(<span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># other options</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout =</span> <span class="dv">900</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># load functions</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>files.sources <span class="ot">&lt;-</span>  <span class="fu">list.files</span>(<span class="st">"R/"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(<span class="fu">paste0</span>(<span class="st">"R/"</span>, files.sources), source))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="downloading-the-data" class="level1">
<h1>Downloading the data</h1>
<p>As described in the <a href="./brazil_download_data.html">download data - instructions</a>, the health data from Brazil can be downloaded in many different ways. Here, it is downloaded with the help of the package <em>microdatasus</em>. The following code block will download the data for the year 2014 (which was chosen randomly).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># malariaData &lt;- fetch_datasus(year_start = 2014, year_end = 2014, information_system = "SINAN-MALARIA")</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/mal14.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="getting-to-know-the-data" class="level1">
<h1>Getting to know the Data</h1>
<section id="variables" class="level3">
<h3 class="anchored" data-anchor-id="variables"><em>Variables</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> There are a total of 50 variables. The variables names can be seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(malariaData)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "TP_NOT"     "ID_AGRAVO"  "DT_NOTIFIC" "SEM_NOT"    "NU_ANO"    
 [6] "SG_UF_NOT"  "ID_MUNICIP" "ID_REGIONA" "ID_UNIDADE" "DT_SIN_PRI"
[11] "SEM_PRI"    "ANO_NASC"   "NU_IDADE_N" "CS_SEXO"    "CS_GESTANT"
[16] "CS_RACA"    "CS_ESCOL_N" "SG_UF"      "ID_MN_RESI" "ID_RG_RESI"
[21] "ID_PAIS"    "DT_INVEST"  "ID_OCUPA_N" "CLASSI_FIN" "AT_ATIVIDA"
[26] "AT_LAMINA"  "AT_SINTOMA" "TPAUTOCTO"  "COUFINF"    "COPAISINF" 
[31] "COMUNINF"   "LOC_INF"    "DEXAME"     "RESULT"     "PMM"       
[36] "PCRUZ"      "TRA_ESQUEM" "DSTRAESQUE" "DTRATA"     "NU_LOTE_I" 
[41] "DT_ENCERRA" "DT_DIGITA"  "DT_TRANSUS" "DT_TRANSDM" "DT_TRANSSM"
[46] "DT_TRANSRM" "DT_TRANSRS" "DT_TRANSSE" "NU_LOTE_V"  "NU_LOTE_H" </code></pre>
</div>
</div>
<p>The definition of each variable can be found in the <a href="workspace/Dictionary_Malaria_PT.pdf">official documentation</a> or <a href="http://portalsinan.saude.gov.br/images/documentos/Agravos/Malaria/DIC_DADOS_Malaria_v5.pdf">online</a> in Portuguese, or in this <a href="workspace/Dictionary_Malaria_EN.csv">translated csv file</a>. This file also contains the decodification for all numerical categories. A small overview of this file can be seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>malariaVarDefPath <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">getwd</span>(), <span class="st">'workspace'</span>, <span class="st">'Dictionary_Malaria_EN.csv'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>malariaVarDef <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(malariaVarDefPath)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(malariaVarDef[<span class="dv">14</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 14%">
<col style="width: 24%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Var</th>
<th style="text-align: left;">Translation</th>
<th style="text-align: left;">Category.1</th>
<th style="text-align: left;">Category.2</th>
<th style="text-align: left;">Category.3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">14</td>
<td style="text-align: left;">RACA</td>
<td style="text-align: left;">Sex</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Black</td>
<td style="text-align: left;">Yellow</td>
</tr>
<tr class="even">
<td style="text-align: left;">15</td>
<td style="text-align: left;">GESTANTE1</td>
<td style="text-align: left;">Pregnancy</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Not applicable</td>
</tr>
<tr class="odd">
<td style="text-align: left;">16</td>
<td style="text-align: left;">NIV_ESCO_1</td>
<td style="text-align: left;">Education level</td>
<td style="text-align: left;">None</td>
<td style="text-align: left;">1-3years</td>
<td style="text-align: left;">4-7years</td>
</tr>
<tr class="even">
<td style="text-align: left;">17</td>
<td style="text-align: left;">GESTANTE.</td>
<td style="text-align: left;">Pregnancy</td>
<td style="text-align: left;">1trimester</td>
<td style="text-align: left;">2trimester</td>
<td style="text-align: left;">3trimester</td>
</tr>
<tr class="odd">
<td style="text-align: left;">18</td>
<td style="text-align: left;">NIV_ESCO</td>
<td style="text-align: left;">Education level</td>
<td style="text-align: left;">Analphabet</td>
<td style="text-align: left;">1-4 incomplete</td>
<td style="text-align: left;">4 complete</td>
</tr>
<tr class="even">
<td style="text-align: left;">19</td>
<td style="text-align: left;">COD_OCUP</td>
<td style="text-align: left;">Occupation</td>
<td style="text-align: left;">Agriculture</td>
<td style="text-align: left;">Pecuaria</td>
<td style="text-align: left;">Domestic</td>
</tr>
<tr class="odd">
<td style="text-align: left;">20</td>
<td style="text-align: left;">TIPO_LAM</td>
<td style="text-align: left;">Type of detection</td>
<td style="text-align: left;">Passive</td>
<td style="text-align: left;">Active</td>
<td style="text-align: left;">LVC</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> To avoid working with unnecessary data, it is useful to filter out the variables that will not be used. Below is a line of code on how to select only the needed variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sel_var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"NU_IDADE_N"</span>,<span class="st">"CS_SEXO"</span>, <span class="st">"CS_GESTANT"</span>, <span class="st">"CS_RACA"</span>, <span class="st">"AT_LAMINA"</span>, <span class="st">"AT_SINTOMA"</span>, <span class="st">"DT_NOTIFIC"</span>, <span class="st">"DT_SIN_PRI"</span>, <span class="st">"DT_DIGITA"</span>, <span class="st">"DEXAME"</span>, <span class="st">"DTRATA"</span>, <span class="st">"ID_MUNICIP"</span>,  <span class="st">"ID_MN_RESI"</span>,  <span class="st">"COMUNINF"</span>,<span class="st">"RESULT"</span>) </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(sel_var))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="completeness-of-the-data" class="level3">
<h3 class="anchored" data-anchor-id="completeness-of-the-data"><em>Completeness of the data</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> Some of these variables are mandatory to notify, others are not, which leads to incomplete datasets. The chart <strong>NACountChart</strong> shows the the variables which have NA-values and the percentage of NAs they contain.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>NACount <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span> <span class="fu">map</span>(<span class="sc">~</span><span class="fu">mean</span>(<span class="fu">is.na</span>(.)))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>NACount <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">count=</span><span class="fu">unlist</span>(NACount),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">var=</span><span class="fu">names</span>(NACount))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(NACount[NACount<span class="sc">$</span>count <span class="sc">!=</span> <span class="dv">0</span>, ], <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(var, count), <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Percentage of NAs in each column"</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Variables"</span>) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_NAs_visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On the contrary, it is also good to know what variables are complete.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>NACount<span class="sc">$</span>var[NACount<span class="sc">$</span>count <span class="sc">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "NU_IDADE_N" "CS_SEXO"    "CS_GESTANT" "DT_NOTIFIC" "DT_SIN_PRI"
[6] "DT_DIGITA"  "ID_MUNICIP"</code></pre>
</div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> To filter out variables which are (almost) completely empty,you can run the following lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>drop_variables <span class="ot">&lt;-</span> NACount<span class="sc">$</span>var[NACount<span class="sc">$</span>count <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData[, <span class="sc">!</span>(<span class="fu">names</span>(malariaData) <span class="sc">%in%</span> drop_variables)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exam-results" class="level4">
<h4 class="anchored" data-anchor-id="exam-results">Exam results</h4>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> The database distinguishes 10 different types/combinations of malaria:</p>
<ol type="1">
<li>Negative</li>
<li><em>Falciparum</em></li>
<li><em>F+Fg</em></li>
<li><em>Vivax</em></li>
<li><em>F+V</em></li>
<li><em>V+Fg</em></li>
<li><em>Fg</em></li>
<li><em>Malariae</em></li>
<li><em>F+M</em> 10.<em>Ovale</em></li>
</ol>
<p>The <strong>negative</strong> notification needs to be filtered (excluded) to obtain the total malaria cases because they are not cases as the exam result was negative. Also, we should exclude NAs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RESULT =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(RESULT <span class="sc">==</span> <span class="st">"1"</span> <span class="sc">~</span> <span class="st">"Negative"</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"2"</span> <span class="sc">~</span> <span class="st">"Falciparum"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"3"</span> <span class="sc">~</span> <span class="st">"F+Fg"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"4"</span> <span class="sc">~</span> <span class="st">"Vivax"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"5"</span> <span class="sc">~</span> <span class="st">"F+V"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"6"</span> <span class="sc">~</span> <span class="st">"V+Fg"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"7"</span> <span class="sc">~</span> <span class="st">"Fg"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"8"</span> <span class="sc">~</span> <span class="st">"Malariae"</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"9"</span> <span class="sc">~</span> <span class="st">"F+M"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                                      RESULT <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">~</span> <span class="st">"Ovale"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malariaData, <span class="fu">aes</span>(<span class="at">x =</span> RESULT, <span class="at">fill=</span>RESULT)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(malariaData<span class="sc">$</span>RESULT)), <span class="st">" NA values"</span>))<span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Exam results during malaria cases in 2014"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">x=</span><span class="st">"Exam Result"</span>, <span class="at">fill=</span><span class="st">"Exam Results"</span>) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>, <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> RESULT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_Type_visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> However, generally, people only distinguish in 3 categories: <em>P. vivax</em> and <em>P. falciparum</em> and the mixed version <em>P+V</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RES_EXAM =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(RESULT <span class="sc">==</span> <span class="st">"Falciparum"</span> <span class="sc">|</span> RESULT <span class="sc">==</span> <span class="st">"F+Fg"</span> <span class="sc">|</span> RESULT <span class="sc">==</span> <span class="st">"Fg"</span> <span class="sc">|</span> RESULT <span class="sc">==</span> <span class="st">"F+M"</span> <span class="sc">~</span> <span class="st">"F"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                        RESULT <span class="sc">==</span> <span class="st">"Vivax"</span> <span class="sc">|</span> RESULT <span class="sc">==</span> <span class="st">"V+Fg"</span> <span class="sc">~</span> <span class="st">"V"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                        RESULT <span class="sc">==</span> <span class="st">"F+V"</span>  <span class="sc">~</span>  <span class="st">"V+F"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                        RESULT <span class="sc">==</span> <span class="st">"Malariae"</span> <span class="sc">|</span> RESULT <span class="sc">==</span> <span class="st">"Ovale"</span> <span class="sc">~</span> <span class="st">"other"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                                        RESULT <span class="sc">==</span> <span class="st">"Negative"</span> <span class="sc">~</span> <span class="st">"Negative"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malariaData, <span class="fu">aes</span>(<span class="at">x =</span> RES_EXAM, <span class="at">fill=</span>RES_EXAM)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Exam results during malaria cases in 2014"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">x=</span><span class="st">"Exam Result"</span>, <span class="at">fill=</span><span class="st">"Exam Results"</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(malariaData<span class="sc">$</span>RES_EXAM)), <span class="st">" NA values"</span>))<span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>, <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> RES_EXAM))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The majority of case are <em>Vivax</em> (2.9%), followed by <em>Falciparum</em> (2.9%). All other categories together make 100%. Fg is the gametocyte phase of the <em>P. falciparum</em> life cycle.</p>
<p>Below, the distribution of the most prevalent malaria can bee seen throughout the year on an epiweek time resolution. Note the <em>vivax</em> and <em>falciparum</em> cases are the combination between more than one <strong>RESULT</strong> category.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_TypeTimeseries-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> To exclude cases with a negative test result, you can run the following lines</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData[malariaData<span class="sc">$</span>RESULT <span class="sc">!=</span> <span class="st">"Negative"</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="information-on-the-patients" class="level1">
<h1>Information on the Patients</h1>
<section id="age-of-patients" class="level3">
<h3 class="anchored" data-anchor-id="age-of-patients"><em>Age of patients</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> For malaria, the age of the patients can be derived from <strong>NU_IDADE_N</strong>. <strong>NU_IDADE_N</strong> is codified:</p>
<ul>
<li>the first number indicates what “dimension” it is using. 1= Hour, 2= day, 3= month, 4= year.</li>
<li>the last numbers indicate the age.</li>
</ul>
<p>The age can be “decodified” with the command line below. This line of code also automatically removes all inconsistent ages, i.e.&nbsp;people over 120 years and people whose age was given in a unusual way (e.g.&nbsp;84 months).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>malariaData  <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AGE =</span> <span class="fu">case_when</span>(NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">120</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(NU_IDADE_N), <span class="co"># assumes that non-codified data means that the age in years was given</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">120</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">1000</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">1000</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">2366</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">2366</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">3000</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">3000</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">3013</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">3013</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">4000</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">4000</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">4120</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(NU_IDADE_N <span class="sc">-</span> <span class="dv">4000</span>),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">4120</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malariaData, <span class="fu">aes</span>(<span class="at">x =</span> AGE))<span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>,<span class="at">color=</span><span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">100</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(malariaData<span class="sc">$</span>AGE)), <span class="st">" NA values"</span>), <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Age [years]"</span>, <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">title=</span><span class="st">"Age distribution"</span>)<span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_Age_visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> Other datasets may include a date of birth, if provided, it can be used to corroborate the real age.</p>
</section>
<section id="sex-of-the-patients" class="level3">
<h3 class="anchored" data-anchor-id="sex-of-the-patients"><em>Sex of the patients</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> The sex of the patients is given by <strong>CS_SEXO</strong>. A table and a barplot of its distribution can be seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CS_SEXO =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(CS_SEXO <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> <span class="st">"Female"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                                       CS_SEXO <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">~</span> <span class="st">"Male"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                       CS_SEXO <span class="sc">==</span> <span class="st">"I"</span> <span class="sc">~</span> <span class="st">"Ignored"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(malariaData, <span class="fu">aes</span>(<span class="at">x =</span> CS_SEXO, <span class="at">fill=</span>CS_SEXO)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Sex distribution of malaria cases in 2015"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">"Sex of the patient"</span>, <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">fill=</span><span class="st">"Sex"</span>)<span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>, <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> CS_SEXO)) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_Sex plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pregnancy" class="level3">
<h3 class="anchored" data-anchor-id="pregnancy"><em>Pregnancy</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> Another related variable is <strong>CS_GESTANT</strong>, which indicates whether the patient is pregnant. Since only women below a certain age can get pregnant this is another way to check for inconsistencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pregnant <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((CS_GESTANT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>mpreg <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CS_SEXO <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">&amp;</span> (CS_GESTANT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>pover50 <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AGE <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">&amp;</span> (CS_GESTANT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> Out of 5 pregnant patients, there are 0 pregnant males and 0 pregnant women over the age of 50. Again, depending on the aim of the study, these patients could be excluded using the following line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(CS_GESTANT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>) <span class="sc">&amp;</span> CS_SEXO <span class="sc">==</span> <span class="st">"M"</span>) <span class="sc">&amp;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(CS_GESTANT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>) <span class="sc">&amp;</span> AGE <span class="sc">&gt;</span> <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="race-of-the-patients" class="level3">
<h3 class="anchored" data-anchor-id="race-of-the-patients"><em>Race of the patients</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> The race of the patient is given by <strong>CS_RACA</strong>. A barplot of its distribution can be seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CS_RACA =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(CS_RACA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"White"</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Black"</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Yellow"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Brown"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Indigenous"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Ignored"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_Race_visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="classifying-the-malaria-cases" class="level1">
<h1>Classifying the malaria cases</h1>
<section id="type-of-detection" class="level3">
<h3 class="anchored" data-anchor-id="type-of-detection"><em>Type of detection</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> Malaria can be detected either actively (when someone goes to doctor because of symptoms), passively (as protocol when one case is detected, people living in the same place are screened) or through LVC (Lamina de Verificaçao de Cura = cure thick blood smear verification). The variable <strong>AT_LAMINA</strong>, shows exactly this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">AT_LAMINA =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(AT_LAMINA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Active"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                       AT_LAMINA <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Passive"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                       AT_LAMINA <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"LVC"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malariaData, <span class="fu">aes</span>(<span class="at">x =</span> AT_LAMINA, <span class="at">fill=</span>AT_LAMINA)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Type of detections of malaria cases in 2014"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">x=</span><span class="st">"Detection type"</span>, <span class="at">fill=</span><span class="st">"Detection type"</span>)<span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> AT_LAMINA),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(malariaData<span class="sc">$</span>AT_LAMINA)), <span class="st">" NA values"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_Detection_visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As can be seen, most cases (65.9%) are found actively and only 7.3% are passively.</p>
</section>
<section id="symptoms" class="level3">
<h3 class="anchored" data-anchor-id="symptoms"><em>Symptoms</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> For malaria, the variable <strong>AT_SINTOMA</strong> makes the distinction whether there are symptoms present or not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">AT_SINTOMA =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(AT_SINTOMA<span class="sc">==</span> <span class="st">"1"</span> <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                                          AT_SINTOMA <span class="sc">==</span> <span class="st">"2"</span> <span class="sc">~</span> <span class="st">"No"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                                          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> Visualise it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span> malariaData, <span class="fu">aes</span>(<span class="at">x =</span> AT_SINTOMA, <span class="at">fill=</span>AT_SINTOMA)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Presence of symptoms during malaria cases in 2014"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">x=</span><span class="st">"Presence of symptoms"</span>, <span class="at">fill=</span><span class="st">"Presence of symptoms"</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(malariaData<span class="sc">$</span>AT_SINTOMA)), <span class="st">" NA values"</span>))<span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>, <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> AT_SINTOMA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_Symptoms_visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A clear majority of NA% malaria cases had symptoms.</p>
</section>
</section>
<section id="timeline-of-malaria-cases" class="level1">
<h1>Timeline of malaria cases</h1>
<section id="notification-distribution-throughout-the-year" class="level3">
<h3 class="anchored" data-anchor-id="notification-distribution-throughout-the-year"><em>Notification distribution throughout the year</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> In the dataset, you can find many dates, one of the most important might be the notification date <strong>DT_NOTIFIC</strong>. This is the first time that a potential malaria patient contacts the medical authorities. Below the annual distribution of notifications during 2014 can be seen. There is no clear seasonal variation but tended to concentrate cases during the summer season in Brazil.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EPIWEEK =</span> <span class="fu">floor_date</span>(DT_NOTIFIC, <span class="st">"weeks"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EPIWEEK) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> EPIWEEK, <span class="at">y =</span> Count)) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%m-%d"</span>, <span class="at">date_breaks =</span> <span class="st">"1 week"</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="timeline-of-all-other-events" class="level3">
<h3 class="anchored" data-anchor-id="timeline-of-all-other-events"><em>Timeline of all other events</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> First, symptoms occur (<strong>DT_SIN_TO_PRI</strong>). Once the doctor notifies a suspected malaria case (<strong>DT_NOTIFIC</strong>), it will be digitized (<strong>DT_DIGITA</strong>). The malaria case needs to be confirmed through an exam (<strong>DEXAME</strong>), and if confirmed, treated (<strong>DTRATA</strong>). Below are boxplots for each of the events date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="ot">&lt;-</span> malariaData <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Symptoms =</span> <span class="fu">as.numeric</span>(DT_SIN_PRI <span class="sc">-</span> DT_NOTIFIC),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Digitalization =</span> <span class="fu">as.numeric</span>(DT_DIGITA <span class="sc">-</span> DT_NOTIFIC),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Exam =</span> <span class="fu">as.numeric</span>(DEXAME <span class="sc">-</span> DT_NOTIFIC),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Treatment =</span> <span class="fu">as.numeric</span>(DTRATA <span class="sc">-</span> DT_NOTIFIC))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>malariaData <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Symptoms, Digitalization, Exam, Treatment) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(TYPE, DAYS) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TYPE, <span class="at">y =</span> DAYS)) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Event"</span>) <span class="sc">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Days from the notification day"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_malaria_files/figure-html/Malaria_Timeline_visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The boxplot is able to visualize possible outliers:</p>
<ul>
<li>The <strong>first symptoms</strong> occur before the notification date, the vast majority of them in the 10 days prior to it. Symptoms that occur after the notification date or a long time before hte notification date may have to be removed.</li>
<li>The <strong>treatment</strong>, <strong>digitalization</strong> and <strong>exam</strong> dates, must fall on or within the 60 days after the notification date. If they fall outside this range, they can be coonsidered outliers and may be removed.</li>
</ul>
</section>
</section>
<section id="mapping-spatially" class="level1">
<h1>Mapping spatially</h1>
<section id="notification-residence-probable-infection" class="level3">
<h3 class="anchored" data-anchor-id="notification-residence-probable-infection"><em>Notification, Residence &amp; Probable Infection</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> There is of course also spatial data in the data sets. Before diving in deeper it is necessary to download the shapefiles of Brazil municipalities. This can be done via the <em>geobr</em> package. However, the municipality code given by geobr is one digit too long and has to be shortened to 6 digits.</p>
<p>In total, the dataset refers to 3 different locations:</p>
<ul>
<li><strong>ID_MUNICIP</strong> is the municipality where the case is notified.</li>
<li><strong>ID_MN_RESI</strong> is the municipality of residence of the patient.</li>
<li><strong>COMUNINF</strong> is the municipality the patient probably got the infection.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># muni &lt;- read_municipality(code_muni = "all", year = 2014, showProgress = FALSE) %&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(code_muni = str_sub(code_muni, end = 6)) %&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(as.data.frame(table(malariaData$ID_MUNICIP, dnn = list("code_muni")), responseName = "noti_muni")) %&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(as.data.frame(table(malariaData$COMUNINF, dnn = list("code_muni")), responseName = "infec_muni")) %&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(as.data.frame(table(malariaData$ID_MN_RESI, dnn = list("code_muni")), responseName = "resi_muni"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Depending on what the aim of the study is, each of these variables can be important.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cols &lt;- c("green", "yellow","orange","red", "black") #change these as needed</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># breaks &lt;- c(0, 10, 100, 1000, 10000, 100000) #change these as needed</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(muni) +</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Extra-Amazon malaria per municipality of notification") +</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = noti_muni), size = .15, show.legend = TRUE) +</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_stepsn(breaks = breaks,</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                     colours = cols,</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#                     values = scales::rescale(breaks))</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(muni) +</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Extra-Amazon malaria per municipality of probable infection") +</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(aes(fill = infec_muni), size = .15, show.legend = TRUE)  +</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_stepsn(breaks = breaks,</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                     colours = cols,</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                     values = scales::rescale(breaks))</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(muni) +</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Extra-Amazon malaria per municipality of residence")+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = resi_muni), size = .15, show.legend = TRUE)  +</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_stepsn(breaks = breaks,</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                     colours = cols,</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                     values = scales::rescale(breaks))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>What did you find after see the maps?</strong> Take a look of the difference between the Extra-Amazon malaria by municipality of notification and probable infection. Almost all malaria notified in the Extra-Amazon region was acquired in the Amazon region. Some people live in the Amazon region were notified in the Extra-Amazon region.</p>
</section>
<section id="mapping-types-of-malaria" class="level3">
<h3 class="anchored" data-anchor-id="mapping-types-of-malaria"><em>Mapping types of Malaria</em></h3>
<p>If one wants to map them distinguishing by type, the following code can be used:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># muni &lt;- muni %&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(as.data.frame(table(malariaData$ID_MUNICIP[malariaData$RES_EXAM == "V"], dnn = list("code_muni")), responseName = "vivax_muni")) %&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(as.data.frame(table(malariaData$ID_MUNICIP[malariaData$RES_EXAM == "F"], dnn = list("code_muni")), responseName = "falci_muni")) %&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(as.data.frame(table(malariaData$ID_MUNICIP[malariaData$RES_EXAM == "V+F"], dnn = list("code_muni")), responseName = "mixed_muni")) %&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(as.data.frame(table(malariaData$ID_MUNICIP[malariaData$RES_EXAM == "other"], dnn = list("code_muni")), responseName = "other_muni"))</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># vivax_plot &lt;- ggplot(muni) +</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = vivax_muni), size = .15, show.legend = TRUE) +</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c() +</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(subtitle = paste0("Number of P. vivax cases in Brazil 2015"), size = 8) +</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># vivax_plot</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># falci_plot &lt;-  ggplot(muni) +</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = falci_muni), size = .15, show.legend = TRUE) +</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c() +</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(subtitle=paste0("Number of P. falciparum cases in Brazil 2015"), size = 8) +</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># falci_plot</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_plot &lt;-  ggplot(muni) +</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = mixed_muni), size = .15, show.legend = TRUE) +</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c() +</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(subtitle=paste0("Number of mixed cases in Brazil 2015"), size = 8) +</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="calculating-the-incidence" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-incidence"><em>Calculating the incidence</em></h3>
<p>Sometimes, having the absolute values is helpful. But other times, the number of cases can be highly dependent on the number of inhabitants and then the incidence or other similar indicator is used. Another reason to use incidence is to make comparable the number of cases between areas and different times. Specifically for malaria, the analogous indicator, the Annual Parasite Index (API) is most common. This indicator is calculated by the number of malaria positive patients occurred in a specific time and place divided by the population per 1.000 inhabitants. This positive patients can be a new case or a relapse. Relapses are most common in malaria <em>vivax</em> infection.</p>
<p>For this, the population data needs to be loaded from <a href="https://www.ibge.gov.br/estatisticas/sociais/populacao/9103-estimativas-de-populacao.html?edicao=31451&amp;t=resultados">IBGE</a> either manually or using the local function “get_br_pop_data” (instructions can be viewed in 0_DownloadData.md).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get_br_pop_data(2015, save=F)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># muni &lt;-  left_join(muni, pop_2015[c("code_muni","pop")], by="code_muni")</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># muni$pop &lt;- as.numeric(muni$pop)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The incidence is then calculated by dividing the malaria cases by the population of each municipality and multiplication by 1000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># muni$noti_inc &lt;- muni$noti_muni / muni$pop*1000</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># muni$infec_inc &lt;- muni$infec_muni / muni$pop*1000</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># muni$resi_inc &lt;- muni$resi_muni / muni$pop*1000</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># breaks2 &lt;- c(0, 5, 25, 50, 100, 250)</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># noti_inci_plot &lt;- ggplot(muni) +</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Incidence of malaria notifications in 2015")+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = noti_inc), size = .15, show.legend = TRUE)  +</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_stepsn(breaks = breaks2,</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                     colours = cols,</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                     values = scales::rescale(breaks2))</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># noti_inci_plot</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co"># infe_inci_plot &lt;- ggplot(muni) +</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Incidence of probable malaria infections in 2015")+</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(aes(fill = infec_inc), size = .15, show.legend = TRUE)  +</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_stepsn(breaks = breaks2,</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                     colours = cols,</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                     values = scales::rescale(breaks2))</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># infe_inci_plot</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co"># resi_inci_plot &lt;- ggplot(muni) +</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Incidence of residents with malaria in 2015")+</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(aes(fill = resi_inc), size = .15, show.legend = TRUE)  +</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_stepsn(breaks = breaks2,</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                     colours = cols,</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                     values = scales::rescale(breaks2))</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co"># resi_inci_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If one wants to know the incidence depending on the malaria type:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># muni$vivax_inc &lt;- muni$vivax_muni / muni$pop*1000</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># muni$falci_inc &lt;- muni$falci_muni / muni$pop*1000</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># muni$mixed_inc &lt;- muni$mixed_muni / muni$pop*1000</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># vivax_inci_plot &lt;- ggplot(muni) +</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(aes(fill = vivax_inc), size = .15, show.legend = TRUE) +</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c() +</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(subtitle = paste0("Vivax incidence in Brazil 2015"), size = 8) +</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co"># vivax_inci_plot</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># falci_inci_plot&lt;- ggplot(muni) +</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = falci_inc), size = .15, show.legend = TRUE) +</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c()+</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(subtitle = paste0("Falciparum incidence in Brazil in 2015"), size = 8) +</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># falci_inci_plot</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_inci_plot&lt;- ggplot(muni) +</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf( aes(fill = mixed_inc), size = .15, show.legend = TRUE) +</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis_c()+</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(subtitle = paste0("Mixed incidence in Brazil in 2015"), size = 8) +</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal()</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed_inci_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Daniela Lührsen, HARMONIZE</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" target="_blank">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/" target="_blank">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>