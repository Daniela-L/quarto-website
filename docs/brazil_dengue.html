<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniela Luhrsen, Rachel Lowe and Raquel Lana">
<meta name="dcterms.date" content="2022-10-27">

<title>Preprocessing Dengue Data – data4health</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/harmonize_logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">data4health</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-home" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Home</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-home">    
        <li>
    <a class="dropdown-item" href="./index.html">
 <span class="dropdown-text">data4health</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./about_project.html">
 <span class="dropdown-text">HARMONIZE project</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./about_tools.html">
 <span class="dropdown-text">Toolkit</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-instructions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Instructions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-instructions">    
        <li class="dropdown-header">Brazil</li>
        <li>
    <a class="dropdown-item" href="./brazil_download_data.html">
 <span class="dropdown-text">Download data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./brazil_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./brazil_malaria.html">
 <span class="dropdown-text">Malaria</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Colombia</li>
        <li>
    <a class="dropdown-item" href="./colombia_lepto.html">
 <span class="dropdown-text">Leptospirosis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./colombia_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Dominican Republic</li>
        <li>
    <a class="dropdown-item" href="./domrep_malaria.html">
 <span class="dropdown-text">Malaria</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./domrep_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Peru</li>
        <li>
    <a class="dropdown-item" href="./peru_dengue.html">
 <span class="dropdown-text">Dengue</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-reports" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Reports</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-reports">    
        <li class="dropdown-header">Brazil</li>
        <li>
    <a class="dropdown-item" href="./brazil_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./brazil_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Colombia</li>
        <li>
    <a class="dropdown-item" href="./colombia_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./colombia_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Dominican Republic</li>
        <li>
    <a class="dropdown-item" href="./domrep_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./domrep_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Peru</li>
        <li>
    <a class="dropdown-item" href="./peru_report_public.html">
 <span class="dropdown-text">General public report</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./peru_report_technical.html">
 <span class="dropdown-text">Technical report</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./ui_tool.html"> 
<span class="menu-text">No-coding tool</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./brazil.html">Brazil</a></li><li class="breadcrumb-item"><a href="./brazil_dengue.html">Dengue</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="1b4e9b07bc2c0b211b44cc4b05a9f2bf" class="alert alert-primary hidden"><i class="bi bi-info-circle quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>Alert</strong> - The person reading this announcement is very pretty.</p>
</div><i class="bi bi-x-lg quarto-announcement-action"></i></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./brazil.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Brazil</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brazil_download_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brazil_dengue.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./brazil_malaria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Malaria</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./colombia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colombia</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./colombia_lepto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leptospirosis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./colombia_dengue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./domrep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dominican Republic</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./domrep_malaria.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Malaria</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./domrep_dengue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./peru.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Peru</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./peru_dengue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dengue</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setting-up-the-r-environment" id="toc-setting-up-the-r-environment" class="nav-link active" data-scroll-target="#setting-up-the-r-environment">Setting up the R environment</a></li>
  <li><a href="#download-the-data-by-microdatasus" id="toc-download-the-data-by-microdatasus" class="nav-link" data-scroll-target="#download-the-data-by-microdatasus">Download the data by microdatasus</a></li>
  <li><a href="#information-on-the-patient" id="toc-information-on-the-patient" class="nav-link" data-scroll-target="#information-on-the-patient">Information on the patient</a>
  <ul class="collapse">
  <li><a href="#age" id="toc-age" class="nav-link" data-scroll-target="#age"><em>Age</em></a></li>
  <li><a href="#sex-of-the-patients" id="toc-sex-of-the-patients" class="nav-link" data-scroll-target="#sex-of-the-patients"><em>Sex of the patients</em></a></li>
  <li><a href="#pregnancy" id="toc-pregnancy" class="nav-link" data-scroll-target="#pregnancy"><em>Pregnancy</em></a></li>
  <li><a href="#racecolor-of-the-patients" id="toc-racecolor-of-the-patients" class="nav-link" data-scroll-target="#racecolor-of-the-patients"><em>Race/Color of the patients</em></a></li>
  </ul></li>
  <li><a href="#information-on-the-cases" id="toc-information-on-the-cases" class="nav-link" data-scroll-target="#information-on-the-cases">Information on the cases</a>
  <ul class="collapse">
  <li><a href="#classification-of-the-dengue-cases" id="toc-classification-of-the-dengue-cases" class="nav-link" data-scroll-target="#classification-of-the-dengue-cases"><em>Classification of the dengue cases</em></a></li>
  <li><a href="#confirmation-criteria-of-the-cases" id="toc-confirmation-criteria-of-the-cases" class="nav-link" data-scroll-target="#confirmation-criteria-of-the-cases"><em>Confirmation criteria of the cases</em></a></li>
  <li><a href="#categories-of-dengue" id="toc-categories-of-dengue" class="nav-link" data-scroll-target="#categories-of-dengue"><em>Categories of dengue</em></a></li>
  <li><a href="#exam-type" id="toc-exam-type" class="nav-link" data-scroll-target="#exam-type"><em>Exam type</em></a></li>
  <li><a href="#evolution-of-case" id="toc-evolution-of-case" class="nav-link" data-scroll-target="#evolution-of-case"><em>Evolution of case</em></a></li>
  </ul></li>
  <li><a href="#timeline-of-dengue-cases" id="toc-timeline-of-dengue-cases" class="nav-link" data-scroll-target="#timeline-of-dengue-cases">Timeline of dengue cases</a>
  <ul class="collapse">
  <li><a href="#notification-distribution-throughout-the-year" id="toc-notification-distribution-throughout-the-year" class="nav-link" data-scroll-target="#notification-distribution-throughout-the-year"><em>Notification distribution throughout the year</em></a></li>
  <li><a href="#duration-of-each-dengue-case" id="toc-duration-of-each-dengue-case" class="nav-link" data-scroll-target="#duration-of-each-dengue-case"><em>Duration of each dengue case</em></a></li>
  <li><a href="#timeline-of-all-other-events" id="toc-timeline-of-all-other-events" class="nav-link" data-scroll-target="#timeline-of-all-other-events"><em>Timeline of all other events</em></a></li>
  </ul></li>
  <li><a href="#mapping-spatially" id="toc-mapping-spatially" class="nav-link" data-scroll-target="#mapping-spatially">Mapping spatially</a>
  <ul class="collapse">
  <li><a href="#absolute-cases" id="toc-absolute-cases" class="nav-link" data-scroll-target="#absolute-cases"><em>Absolute cases</em></a></li>
  <li><a href="#calculate-the-incidence" id="toc-calculate-the-incidence" class="nav-link" data-scroll-target="#calculate-the-incidence"><em>Calculate the incidence</em></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./brazil.html">Brazil</a></li><li class="breadcrumb-item"><a href="./brazil_dengue.html">Dengue</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Preprocessing Dengue Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniela Luhrsen, Rachel Lowe and Raquel Lana </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 27, 2022</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>This document aims at introducing dengue data to someone with no previous experience. Before starting it is necessary to have the health data, instructions on how to obtain these are in the ReadMe of this project.</p>
<p>The steps include:</p>
<ol type="1">
<li>Downloading the data</li>
<li>Getting to know the data: detect differences between different datasets</li>
<li>Information on the patients: Age, Sex, Pregnancy, Race</li>
<li>Information on the case: classification, confirmation criteria, dengue category, exam type, evolution of the case</li>
<li>Timeline of the dengue case: distribution throughout the year, duration of cases, course of the disease</li>
<li>Mapping spatially: Absolute cases, incidence</li>
</ol>
<p>Along the way, each topic will be divided into 3:</p>
<ul>
<li><p><img src="images/idea-02.png" class="img-fluid" width="25"> indicates that you will learn something</p></li>
<li><p><img src="images/eye-01.png" class="img-fluid" width="24"> indicates that you will see the data in a plot</p></li>
<li><p><img src="images/filter-01.png" class="img-fluid" width="20"> indicates that there is a opportunity to filter data (if necessary).</p></li>
</ul>
<section id="setting-up-the-r-environment" class="level1">
<h1>Setting up the R environment</h1>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> In every R script,</p>
<p>In this script we will need the following R-scripts:</p>
<ul>
<li><p>microdatasus: To download the health data from brazil</p></li>
<li><p>foreign: this function is used to read dbf files</p></li>
<li><p>read.dbc: to open the files in .dbc format</p></li>
<li><p>readr: to open csv files</p></li>
<li><p>purrr:</p></li>
<li><p>ggplot2: to create the graphs</p></li>
<li><p>lubridate: to help format the dates</p></li>
<li><p>geobr: to download the shapefiles of brazils administrative boundaries</p></li>
<li><p>stringr: to support string modifications</p></li>
<li><p>patchwork:</p></li>
<li><p>knitr: to create interactive tables</p></li>
<li><p>scales: to rescale continuous vectors to have limits</p></li>
<li><p>dplyr &amp; tidyr: to use functions from the “tidyverse”</p></li>
</ul>
<p>Other options that are being set up now include, setting a maximum waiting time for functions (i.e.&nbsp;timeout), how large numbers should be displayed (i.e. scipen) and functions are locally loaded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>packages  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"microdatasus"</span>, <span class="st">"foreign"</span>, <span class="st">"read.dbc"</span>, <span class="st">"readr"</span>, <span class="st">"dplyr"</span>, <span class="st">"purrr"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">"ggplot2"</span>,<span class="st">"lubridate"</span>,<span class="st">"geobr"</span>, <span class="st">"stringr"</span>, <span class="st">"patchwork"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"arsenal"</span>, <span class="st">"knitr"</span>, <span class="st">"scales"</span>, <span class="st">"tidyr"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">install.packages</span>(<span class="fu">setdiff</span>(packages, <span class="fu">rownames</span>(<span class="fu">installed.packages</span>()))))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(packages, <span class="cf">function</span>(pkg) <span class="fu">suppressMessages</span>(<span class="fu">require</span>(pkg, <span class="at">character.only =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set options</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">timeout =</span> <span class="dv">2000</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># load functions</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>files.sources <span class="ot">&lt;-</span>  <span class="fu">list.files</span>(<span class="st">"R/"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">sapply</span>(<span class="fu">paste0</span>(<span class="st">"R/"</span>, files.sources), source))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-the-data-by-microdatasus" class="level1">
<h1>Download the data by microdatasus</h1>
<p>As described in the <a href="./brazil_download_data.html">download instructions</a>, the health data from Brazil can be downloaded by many different methods: <em>microdatasus</em>, PySUS or by Filezilla <a href="ftp.datasus.gov.br">FTP link</a>. In this script, the data will be downloaded with the help of the package <a href="https://rfsaldanha.github.io/microdatasus/"><em>microdatasus</em></a>, the following code block is an example that will download the data for the year 2015. The dengue database is heavy and it can take time to download it. It is therefor recommended to download the data once and save it to your computer. Afterwards you can load it from your local disk every time you want to analyse it.</p>
<p>In the case of this script, run it the first code block once (with the second code block commented out), and then you can comment out the first code block and uncomment the first code block.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># den15 &lt;- fetch_datasus(year_start = 2015, year_end = 2015, information_system = "SINAN-DENGUE")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--#  Sometimes problems with the variables occur when downloading data from mutiple years (e.g. 2012 to 2015). The developer are already aware of this. For now, download each year one by one, then import all years using bind_rows and use an argument to import all variables as a character.-->
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>den15 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/den15.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="understanding-the-data-structure" class="level4">
<h4 class="anchored" data-anchor-id="understanding-the-data-structure">Understanding the data structure</h4>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> Specifically, it contains 139 variables, the explanation for each variable can be found on the <a href="portalsinan.saude.gov.br/images/documentos/Agravos/Dengue/DIC_DADOS_ONLINE.pdf">SINAN webpage</a> from the Ministry of Health of Brazil. However, it is only available in Portuguese. A translation into English can be found in <a href="Workspace/Dictionary_Dengue.csv">this csv file</a>. This file also contains the decodification for all numerical categories. A small overview of this file can be seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>varEng <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"workspace/Dictionary_Dengue.csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(varEng[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Var</th>
<th style="text-align: left;">Eng</th>
<th style="text-align: left;">1</th>
<th style="text-align: left;">2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ACIDO_PEPT</td>
<td style="text-align: left;">Preexistence of peptic acid illness</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">ALRM_ABDOM</td>
<td style="text-align: left;">Alarm sign: Abdominal pain</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ALRM_HEMAT</td>
<td style="text-align: left;">Alarm sign: Hematocrit increase</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">ALRM_HEPAT</td>
<td style="text-align: left;">Alarm sign: Hepatomegaly</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ALRM_HIPOT</td>
<td style="text-align: left;">Alarm sign: Hipotension</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: left;">ALRM_LETAR</td>
<td style="text-align: left;">Alarm sign: Lethargy or irritability</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Some of these variables are mandatory to notify, others are not, which leads to incomplete datasets. The dataframe <strong>NAcount</strong> shows the percentage of NA-values for each variable, below you can see it graphically for some of the variables. Here, we chose as the main database to explore the variables, den15, a database you can download by the FTP link.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>NAcount <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span><span class="fu">mean</span>(<span class="fu">is.na</span>(.)))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>NAcount <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">unlist</span>(NAcount))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>NAcount[<span class="st">"var"</span>] <span class="ot">&lt;-</span> <span class="fu">rownames</span>(NAcount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> You can visualise it here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(NAcount[<span class="dv">35</span><span class="sc">:</span><span class="dv">55</span>,], <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(var, unlist.NAcount.), <span class="at">y =</span> unlist.NAcount.))<span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.9</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Percentage of NAs in each column"</span>)<span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Variables"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_NACount-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The variables with complete datasets are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>NAcount<span class="sc">$</span>var[NAcount<span class="sc">$</span>unlist.NAcount. <span class="sc">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "TP_NOT"     "ID_AGRAVO"  "DT_NOTIFIC" "SEM_NOT"    "NU_ANO"    
[6] "SG_UF_NOT"  "ID_MUNICIP" "SEM_PRI"    "NU_IDADE_N"</code></pre>
</div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> To avoid working with unnecessary data, it is useful to filter out the variables that will not be used. Below is a line of code on how to select only the needed variables.</p>
<p>Change this list as needed!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sel_var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"DT_NOTIFIC"</span>,  <span class="st">"ID_MUNICIP"</span>,  <span class="st">"DT_SIN_PRI"</span>, <span class="st">"DT_NASC"</span>, <span class="st">"NU_IDADE_N"</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"CS_SEXO"</span>, <span class="st">"CS_GESTANT"</span>, <span class="st">"CS_RACA"</span>, <span class="st">"ID_MN_RESI"</span>,  <span class="st">"COMUNINF"</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"CLASSI_FIN"</span>, <span class="st">"CRITERIO"</span>,  <span class="st">"EVOLUCAO"</span>, <span class="st">"DT_OBITO"</span>, <span class="st">"DT_SORO"</span>,  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"DT_ENCERRA"</span>, <span class="st">"RES_CHIKS1"</span>,<span class="st">"RES_CHIKS2"</span>, <span class="st">"RESUL_PRNT"</span>,<span class="st">"RESUL_SORO"</span>,<span class="st">"RESUL_NS1"</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"RESUL_VI_N"</span>, <span class="st">"RESUL_PCR_"</span>,<span class="st">"HISTOPA_N"</span>,<span class="st">"IMUNOH_N"</span>, <span class="st">"MUNICIPIO"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>den15 <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(sel_var))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ### VER Ver duplicados antes aqui, ver a comparaçao entre os dados do
FTP e solicitados. Parece que precisa de data de nascimento para deduplicar.
Probably we can't deduplicate the files from FTP. Check well the files from the
MS. There is library in Python that can help
https://pypi.org/project/pandas-dedupe/. ver 2015, esse veio do ministério 
::: {.cell}

```{.checking .cell-code}
# Filtro: duplicidade ----
# den15 %>%
#   distinct(NU_NOTIFIC, DT_NOTIFIC, ID_MUNICIP, .keep_all = T) %>% dplyr::count()
#
# den15 %>%
#   distinct(NU_NOTIFIC, DT_NOTIFIC, ID_MUNICIP, DT_NASC, ID_UNIDADE, .keep_all = T) %>% dplyr::count()
```
:::
--\>

<!-- DL: Tego que terminar esto -->
</section>
</section>
<section id="information-on-the-patient" class="level1">
<h1>Information on the patient</h1>
<section id="age" class="level3">
<h3 class="anchored" data-anchor-id="age"><em>Age</em></h3>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> For dengue, there are two methods to obtain the age of the patients. First, using the data about the patients birth-date, which is provided in the variable <strong>DT_NASC</strong>. The age can be calculated by subtracting the birth-date from the notification date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>den15 <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">AGE_BIRTHDAY =</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">ifelse</span>(<span class="fu">format</span>(den15<span class="sc">$</span>DT_NASC, <span class="st">"%m-%d"</span>) <span class="sc">&gt;</span> <span class="fu">format</span>(den15<span class="sc">$</span>DT_NOTIFIC, <span class="st">"%m-%d"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                    lubridate<span class="sc">::</span><span class="fu">year</span>(den15<span class="sc">$</span>DT_NOTIFIC)<span class="sc">-</span>lubridate<span class="sc">::</span><span class="fu">year</span>(den15<span class="sc">$</span>DT_NASC)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    lubridate<span class="sc">::</span><span class="fu">year</span>(den15<span class="sc">$</span>DT_NOTIFIC)<span class="sc">-</span>lubridate<span class="sc">::</span><span class="fu">year</span>(den15<span class="sc">$</span>DT_NASC)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye-01.png" class="img-fluid" width="24"> You can visualise it here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(den15, <span class="fu">aes</span>(<span class="at">x =</span> AGE_BIRTHDAY))<span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>,<span class="at">color=</span><span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">100</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(den15<span class="sc">$</span>AGE_BIRTHDAY)), <span class="st">" NA values"</span>))<span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Age [years]"</span>, <span class="at">y=</span><span class="st">"Count"</span>, <span class="at">title=</span><span class="st">"Age distribution according to the birthday field"</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_AgeBirthday-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="images/idea-02.png" class="img-fluid" width="25"> However, <strong>DT_NASC</strong> is not a mandatory variable, thus, there are many missing values. Instead, <strong>NU_IDADE_N</strong> can be used. <strong>NU_IDADE_N</strong> is codified as follows:</p>
<ul>
<li>the first number indicates what “dimension” it is using. 1= Hour, 2= day, 3= month, 4= year.</li>
<li>the last numbers indicate the age. The age can be “decodified” with the below command line.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>den15  <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">AGE_CODE =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">120</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(NU_IDADE_N), <span class="co"># assumes that non-codified data means that the age in years was given</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">120</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">1000</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">1000</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">2366</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">2366</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">3000</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">3000</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">3013</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">3013</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">4000</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">4000</span> <span class="sc">&amp;</span> NU_IDADE_N <span class="sc">&lt;</span> <span class="dv">4120</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(NU_IDADE_N <span class="sc">-</span> <span class="dv">4000</span>),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                           NU_IDADE_N <span class="sc">&gt;=</span> <span class="dv">4120</span> <span class="sc">~</span> <span class="cn">NA_real_</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(den15[den15<span class="sc">$</span>AGE_CODE <span class="sc">&lt;</span> <span class="dv">120</span>,], <span class="fu">aes</span>(<span class="at">x =</span> AGE_CODE))<span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>,<span class="at">color=</span><span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">100</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(den15<span class="sc">$</span>AGE_CODE)), <span class="st">" NA values"</span>))<span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Age [years]"</span>, <span class="at">y=</span><span class="st">"Count"</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Age distribution according to the codified age field"</span>)<span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_AgeCode-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The two histograms are very similar, however there is a noticeable difference in the amount of people aged 0. Below are the first few lines of cases where the two calculated ages differ:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>compare_age <span class="ot">&lt;-</span> den15[(den15<span class="sc">$</span>AGE_BIRTHDAY <span class="sc">-</span> den15<span class="sc">$</span>AGE_CODE) <span class="sc">&gt;</span><span class="dv">1</span>,] <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(DT_NASC, NU_IDADE_N, AGE_CODE, AGE_BIRTHDAY)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(compare_age[<span class="sc">!</span><span class="fu">is.na</span>(compare_age<span class="sc">$</span>DT_NASC),]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">DT_NASC</th>
<th style="text-align: right;">NU_IDADE_N</th>
<th style="text-align: right;">AGE_CODE</th>
<th style="text-align: right;">AGE_BIRTHDAY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">16</td>
<td style="text-align: left;">1961-02-03</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">53</td>
</tr>
<tr class="even">
<td style="text-align: left;">351</td>
<td style="text-align: left;">2001-08-21</td>
<td style="text-align: right;">4010</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">472</td>
<td style="text-align: left;">1994-12-24</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">1100</td>
<td style="text-align: left;">2009-02-26</td>
<td style="text-align: right;">3002</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1252</td>
<td style="text-align: left;">1991-07-08</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: left;">1395</td>
<td style="text-align: left;">2000-06-11</td>
<td style="text-align: right;">2001</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> There are many people with an age code of 0, but with an birthdate, that indicates a different age. Another common way to filter inconsistencies is to discard people above the age of 120.</p>
<!-- Introduce line of code to filter. -->
</section>
<section id="sex-of-the-patients" class="level3">
<h3 class="anchored" data-anchor-id="sex-of-the-patients"><em>Sex of the patients</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> The sex of the patients is given by <strong>CS_SEXO</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>den15 <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CS_SEXO =</span> <span class="fu">as.factor</span>(dplyr<span class="sc">::</span><span class="fu">case_when</span>(CS_SEXO <span class="sc">==</span> <span class="st">"F"</span> <span class="sc">~</span> <span class="st">"Female"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                       CS_SEXO <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">~</span> <span class="st">"Male"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                       CS_SEXO <span class="sc">==</span> <span class="st">"I"</span> <span class="sc">~</span> <span class="st">"Ignored"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye.png" class="img-fluid" width="30" alt="Learn"> A bar plot of its distribution can be seen below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(den15, <span class="fu">aes</span>(<span class="at">x =</span> CS_SEXO, <span class="at">fill=</span>CS_SEXO))<span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Sex distribution of dengue cases in 2015"</span>)<span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sex of the patient"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill=</span><span class="st">"Sex"</span>)<span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(den15<span class="sc">$</span>CS_SEXO)), <span class="st">" NA values"</span>))<span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_Sex-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pregnancy" class="level3">
<h3 class="anchored" data-anchor-id="pregnancy"><em>Pregnancy</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> Another related variable is <strong>CS_GESTANT</strong>, which indicates whether the patient is pregnant. Since only women below a certain age can get pregnant this is another way to check for inconsistencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pregnant <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>((CS_GESTANT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>mpreg <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(CS_SEXO <span class="sc">==</span> <span class="st">"M"</span> <span class="sc">&amp;</span> (CS_GESTANT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>pover50 <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(AGE_CODE <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">&amp;</span> (CS_GESTANT <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span><span class="dv">3</span> <span class="sc">|</span> CS_GESTANT <span class="sc">==</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/filter.png" class="img-fluid" width="20" alt="Filter"> Out of 13382 pregnant patients, there are 0 pregnant males and 764 pregnant women over the age of 50. Again, depending on the aim of the study, these patients could be excluded using the following line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>den15 <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(CS_GESTANT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>) <span class="sc">&amp;</span> CS_SEXO <span class="sc">==</span> <span class="st">"M"</span>) <span class="sc">&amp;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span>(CS_GESTANT <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>) <span class="sc">&amp;</span> AGE_CODE <span class="sc">&gt;</span> <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="racecolor-of-the-patients" class="level3">
<h3 class="anchored" data-anchor-id="racecolor-of-the-patients"><em>Race/Color of the patients</em></h3>
<p><img src="images/idea.png" class="img-fluid" alt="Learn" width="20"> The race/color of the patient is given by <strong>CS_RACA</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>den15 <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CS_RACA =</span> <span class="fu">as.factor</span>(dplyr<span class="sc">::</span><span class="fu">case_when</span>(CS_RACA <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"White"</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Black"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Yellow"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Brown"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Indigenous"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                                       CS_RACA <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Ignored"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye.png" class="img-fluid" alt="Learn" width="30"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(den15, <span class="fu">aes</span>(<span class="at">x =</span> CS_RACA, <span class="at">fill=</span>CS_RACA)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Race/Color distribution of dengue cases in 2015"</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> CS_RACA),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Race/Color of the patient"</span>, <span class="at">y=</span><span class="st">"Count"</span>,<span class="at">fill=</span><span class="st">"Race/Color"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_Race_Visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note the amount of missing values and ignored for race/color.</p>
</section>
</section>
<section id="information-on-the-cases" class="level1">
<h1>Information on the cases</h1>
<section id="classification-of-the-dengue-cases" class="level3">
<h3 class="anchored" data-anchor-id="classification-of-the-dengue-cases"><em>Classification of the dengue cases</em></h3>
<p><img src="images/idea.png" class="img-fluid" width="20" alt="Learn"> This database collects all the <strong>suspected</strong> cases of dengue, however, not all suspected cases are considered as probable or confirmed. The variable <strong>CLASSI_FIN</strong> gives insight about the final classification and severity of each case. It is important to note that since 2015 there are new classification rules, consequently the codification of this variables changed too. Before 2015 the numbers 1-5 were used, and now 5-13 (5 always meing “discarded”). The code is as follows:</p>
<p>1 - Classic Dengue Fever 2 - Severe Dengue 3 - Dengue Hemorrhagic Fever - DHF 4 - Dengue Shock Syndrome 5 - Discarded 8 - Inconclusive 10 - Dengue 11 - Dengue with warning signs) 12 - Severe Dengue 13 - Chikungunya</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>classification <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">CLASSI_FIN =</span> <span class="fu">as.factor</span>(dplyr<span class="sc">::</span><span class="fu">case_when</span>(CLASSI_FIN <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Dengue"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Severe Dengue"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Dengue Hemorrhagic Fever"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Dengue Shock Syndrome"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"Discarded"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Inconclusive"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="st">"Dengue"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">"Dengue with </span><span class="sc">\n</span><span class="st">warning signals"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"Severe Dengue"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                                      CLASSI_FIN <span class="sc">==</span> <span class="dv">13</span> <span class="sc">~</span> <span class="st">"Chikungunya"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                                      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/eye.png" class="img-fluid" alt="Learn" width="30"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(classification) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> CLASSI_FIN, <span class="at">fill=</span>CLASSI_FIN)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> CLASSI_FIN),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Classification category"</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Count"</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Final classification of dengue cases in 2015"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill=</span> <span class="st">"Classification"</span>)<span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_Classification_Visualise-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="images/filter.png" class="img-fluid" alt="Filter" width="20"> Almost 29.1% of the cases in 2015 were <strong>discarded</strong>. If a study only considers <strong>probable</strong> dengue cases, these discarded cases, as well as those without classification, should be discarded.</p>
</section>
<section id="confirmation-criteria-of-the-cases" class="level3">
<h3 class="anchored" data-anchor-id="confirmation-criteria-of-the-cases"><em>Confirmation criteria of the cases</em></h3>
<p><img src="images/idea.png" class="img-fluid" alt="Learn" width="20"> It can be of interest how the dengue case are confirmed. Information about the type of confirmation can be extracted from the variable <strong>CRITERIO</strong>. In Brazil there are three different options:</p>
<ul>
<li>laboratory exams</li>
<li>clinical epidemiological, which means that a physician talked to the patient.</li>
<li>Unknown</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>criteria <span class="ot">&lt;-</span>  den15 <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(CRITERIO, <span class="at">name =</span> <span class="st">"count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">percentage =</span> <span class="fu">prop.table</span>(count),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">category =</span> <span class="fu">c</span>(<span class="st">"Laboratory"</span>, <span class="st">"Clinical epidimiological"</span>,<span class="st">"Under investigation"</span>,<span class="st">"Unknown"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(criteria, <span class="fu">aes</span>(<span class="at">x =</span> category, <span class="at">y =</span> count, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(percentage <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>)),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Confirmation criteria"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Confirmation criteria of dengue cases in 2015"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Confirmation Criteria"</span>) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_ConfirmationCriteria-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>49.8% of the cases were confirmed/discarded via the criteria of <em>clinical epiediomogical</em>, and 36.6% via <em>laboratory exams</em>. A detailed description of which exams are tipically used can be seen in the <a href="####exam-type">exam type section</a>.</p>
<p><img src="images/filter.png" class="img-fluid" alt="Filter" width="20"> If you are interest solely in <strong>confirmed</strong> cases, then all cases with unknown or missing criteria have to be dismissed.</p>
</section>
<section id="categories-of-dengue" class="level3">
<h3 class="anchored" data-anchor-id="categories-of-dengue"><em>Categories of dengue</em></h3>
<p><img src="images/idea.png" class="img-fluid" alt="Learn" width="20"> Based on its classification and confirmation criterium, dengue cases can be categorized into 4 different categories. They have been mentioned in the previous sections, but for clarity they are listed and defined here again:</p>
<ul>
<li><em>Suspect cases</em>: all notifications.</li>
<li><em>Confirmed cases</em>: dengue cases confirmed by laboratory or clinic-epidemiological criteria.</li>
<li><em>Probable cases</em>: dengue cases discarding missing values and discarded category of the CLASSI_FIN variable.</li>
<li><em>Discarded</em> category of the CLASSI_FIN variable.</li>
</ul>
</section>
<section id="exam-type" class="level3">
<h3 class="anchored" data-anchor-id="exam-type"><em>Exam type</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> In the case of confirmation via <em>laboratory exams</em>, there are 9 different possible exams. Each exam has its own variable, with a numerical code that indicates its result:</p>
<ol type="1">
<li>means the result of the exam is positive</li>
<li>means the result of the exam is negative</li>
<li>means the result of the exam is inconclusive</li>
<li>means the exam was not realized</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>exams <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(CRITERIO <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="st">'Serological exam 1 (Chikungunya)'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(RES_CHIKS1) <span class="sc">&amp;</span> RES_CHIKS1 <span class="sc">!=</span> <span class="dv">4</span> ),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Serological exam 2 (Chikungunya)'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(RES_CHIKS2) <span class="sc">&amp;</span> RES_CHIKS2 <span class="sc">!=</span> <span class="dv">4</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'PRNT exam'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(RESUL_PRNT) <span class="sc">&amp;</span> RESUL_PRNT <span class="sc">!=</span> <span class="dv">4</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Serological exam (dengue)'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(RESUL_SORO) <span class="sc">&amp;</span> RESUL_SORO <span class="sc">!=</span> <span class="dv">4</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'NS1 exam'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(RESUL_NS1) <span class="sc">&amp;</span> RESUL_NS1 <span class="sc">!=</span> <span class="dv">4</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Viral isolation'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(RESUL_VI_N) <span class="sc">&amp;</span> RESUL_VI_N <span class="sc">!=</span> <span class="dv">4</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'PCR exam'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(RESUL_PCR_) <span class="sc">&amp;</span> RESUL_PCR_ <span class="sc">!=</span> <span class="dv">4</span>),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Histopatology exam'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(HISTOPA_N) <span class="sc">&amp;</span> HISTOPA_N <span class="sc">!=</span> <span class="dv">4</span>),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Immunohistochemistry exam'</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(IMUNOH_N) <span class="sc">&amp;</span> IMUNOH_N <span class="sc">!=</span> <span class="dv">4</span>))</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>exams <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">var=</span> <span class="fu">colnames</span>(exams), <span class="at">val=</span> <span class="fu">t</span>(exams))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(exams, <span class="fu">aes</span>(<span class="at">x =</span> var, <span class="at">y =</span> val, <span class="at">fill=</span>val)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,<span class="fu">aes</span>(<span class="fu">reorder</span>(var, val), val)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Frequency of each lab exam performed for dengue cases in 2015"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Exams"</span>) <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As can be seen, the serological exam is by far the most used one, followed by NS1. The other exams are hardly used.</p>
</section>
<section id="evolution-of-case" class="level3">
<h3 class="anchored" data-anchor-id="evolution-of-case"><em>Evolution of case</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> Finally, the variable <strong>EVOLUCAO</strong> defines the outcome of each dengue case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>evolution <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">EVOLUCAO =</span> <span class="fu">as.factor</span>(dplyr<span class="sc">::</span><span class="fu">case_when</span>(EVOLUCAO <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Cured"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                                    EVOLUCAO <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Death by </span><span class="sc">\n</span><span class="st">illness"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                                    EVOLUCAO <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Death by </span><span class="sc">\n</span><span class="st">other cause"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                                    EVOLUCAO <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Death under </span><span class="sc">\n</span><span class="st">investigation"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                                    EVOLUCAO <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Ignored"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NA"</span>)))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(evolution) <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> EVOLUCAO, <span class="at">fill=</span> EVOLUCAO)) <span class="sc">+</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">stat =</span> <span class="st">'count'</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>((<span class="fu">after_stat</span>(count))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">after_stat</span>(count)) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%"</span>),</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> EVOLUCAO),</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Category"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill=</span><span class="st">"Category"</span>, <span class="at">title=</span><span class="st">"Final outcomes of dengue cases in 2015"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_Evolution-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="timeline-of-dengue-cases" class="level1">
<h1>Timeline of dengue cases</h1>
<section id="notification-distribution-throughout-the-year" class="level3">
<h3 class="anchored" data-anchor-id="notification-distribution-throughout-the-year"><em>Notification distribution throughout the year</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> The date of the first time that a potential dengue patient contacts the medical authorities is recorded as <strong>DT_NOTIF</strong>. This variable can be used to see clear temporal patterns throughout the year. Below, there is the annual distribution of dengue notifications in 2015, plotted at a temporal resolution of epidemiological week. In an epidemiological week, the week starts on Sunday.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dengueEpiWeek <span class="ot">&lt;-</span> den15 <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">epiweek =</span> <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%02d"</span>,lubridate<span class="sc">::</span><span class="fu">epiweek</span>(DT_NOTIFIC)), <span class="st">"-2015"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(epiweek) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">count =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(epiweek, count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(dengueEpiWeek, <span class="fu">aes</span>(<span class="at">x =</span> epiweek, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"darkgrey"</span>,<span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(den15<span class="sc">$</span>DT_NOTIFIC)), <span class="st">" NA values"</span>)) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Suspected dengue cases in 2015 by epiweek"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Epiweek"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There is a clear seasonal variation, with the peak presenting itself in the middle of the Autumn season in Brazil.</p>
</section>
<section id="duration-of-each-dengue-case" class="level3">
<h3 class="anchored" data-anchor-id="duration-of-each-dengue-case"><em>Duration of each dengue case</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> Once the initial notification happens, the timeline of each case starts. The duration of the complete process is delimited by the “closing date” (<strong>DT_ENCERRA</strong>). Below is a histogram to see the duration of each dengue case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>duration <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(den15<span class="sc">$</span>DT_ENCERRA <span class="sc">-</span> den15<span class="sc">$</span>DT_NOTIFIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">duration =</span> duration[duration <span class="sc">&lt;</span> <span class="dv">100</span>]), <span class="fu">aes</span>(<span class="at">x =</span> duration)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>,<span class="at">color=</span><span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="cn">Inf</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(den15<span class="sc">$</span>DT_ENCERRA)), <span class="st">" NA values"</span>)) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Duration from notification to closing of the case"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time [days]"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 19525 rows containing non-finite values (`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There is an extremely large amount of cases that end on the 61st day, to be specific 20.01%. Only 10.14% of the case take longer than 61 days.</p>
</section>
<section id="timeline-of-all-other-events" class="level3">
<h3 class="anchored" data-anchor-id="timeline-of-all-other-events"><em>Timeline of all other events</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> There are many dates recorded to be able ti understand the course of the disease. First, symptoms occur (<strong>DT_SIN_PRI</strong>), this occurs before the notification date. Once the doctor notified a dengue suspicion (<strong>DT_NOTIF</strong>) the case needs to be confirmed via an exams, this should happen shortly after the notification. Finally, there must be a closing date (<strong>DT_ENCERRA</strong>) or date of death (<strong>DT_OBITO</strong>). Both of these have to be after the notification date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A_SYMP =</span> <span class="fu">as.numeric</span>(den15<span class="sc">$</span>DT_SIN_PRI <span class="sc">-</span> den15<span class="sc">$</span>DT_NOTIFIC),</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">B_SORO =</span> <span class="fu">as.numeric</span>(den15<span class="sc">$</span>DT_SORO <span class="sc">-</span> den15<span class="sc">$</span>DT_NOTIFIC),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">C_DEAD =</span> <span class="fu">as.numeric</span>(den15<span class="sc">$</span>DT_OBITO <span class="sc">-</span> den15<span class="sc">$</span>DT_NOTIFIC),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">D_TOTAL =</span> <span class="fu">as.numeric</span>(den15<span class="sc">$</span>DT_ENCERRA <span class="sc">-</span> den15<span class="sc">$</span>DT_NOTIFIC))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">gather</span>(time, TYPE, DAYS, A_SYMP<span class="sc">:</span>D_TOTAL)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(long, <span class="fu">aes</span>(<span class="at">x =</span> TYPE, <span class="at">y =</span> DAYS)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Event"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"Days from the notification day"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"First Symptoms"</span>, <span class="st">"Sorological Exam"</span>, <span class="st">"Death"</span>, <span class="st">"Case closed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4089321 rows containing non-finite values (`stat_boxplot()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="images/filter-01.png" class="img-fluid" width="20"> Most dates should fall within a few days before the notification day or within two months after it. However, looking at the boxplots, this is clearly not the case. If one wants to work with the timeline of dengue cases, these erroneous cases need to be removed, e.g.&nbsp;someone dying before the notification date or someone having their first symptoms on the 215-04-03.</p>
</section>
</section>
<section id="mapping-spatially" class="level1">
<h1>Mapping spatially</h1>
<section id="absolute-cases" class="level3">
<h3 class="anchored" data-anchor-id="absolute-cases"><em>Absolute cases</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> There is of course also spatial data in the datasets. Before beginning the analysis, it is necessary to download the shapefiles of Brazils municipalities. This can be done via the <em>geobr</em> package (more info on this in 0_DownloadData.md). However, the municipality code given by geobr is one digit too long and has to be shortened to 6 digits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>muni <span class="ot">&lt;-</span> geobr<span class="sc">::</span><span class="fu">read_municipality</span>(<span class="at">code_muni =</span> <span class="st">"all"</span>, <span class="at">year =</span> <span class="dv">2015</span>, <span class="at">showProgress =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">code_muni =</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(code_muni, <span class="at">end =</span> <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In total, the dataset refers to 4 different locations:</p>
<ul>
<li><strong>ID_MUNICIP</strong> is the municipality where the case is recorded.</li>
<li><strong>ID_MN_RESI</strong> is the municipality of residence of the patient.</li>
<li><strong>COMUNINF</strong> is the probable municipality of infection.</li>
<li><strong>MUNICIPIO</strong> is the municipality of the hospital (if hospitalized).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>noti <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(den15<span class="sc">$</span>ID_MUNICIP, <span class="at">dnn =</span> <span class="fu">list</span>(<span class="st">"code_muni"</span>)), <span class="at">responseName =</span> <span class="st">"noti_muni"</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>infec <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(den15<span class="sc">$</span>COMUNINF, <span class="at">dnn =</span> <span class="fu">list</span>(<span class="st">"code_muni"</span>)), <span class="at">responseName =</span> <span class="st">"infec_muni"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>resi <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(den15<span class="sc">$</span>ID_MN_RESI, <span class="at">dnn =</span> <span class="fu">list</span>(<span class="st">"code_muni"</span>)), <span class="at">responseName =</span> <span class="st">"resi_muni"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>hosp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(den15<span class="sc">$</span>MUNICIPIO, <span class="at">dnn =</span> <span class="fu">list</span>(<span class="st">"code_muni"</span>)), <span class="at">responseName =</span> <span class="st">"hosp_muni"</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>allmuni <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(muni, noti) <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., infec) <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., resi) <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(., hosp)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"yellow"</span>,<span class="st">"orange"</span>,<span class="st">"red"</span>, <span class="st">"black"</span>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dv">10000</span>,<span class="dv">100000</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>noti <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Notification municipality"</span>)<span class="sc">+</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill=</span>noti_muni), <span class="at">size=</span>.<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks,</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks))</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>infec <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Probable infections municipality"</span>)<span class="sc">+</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill=</span>infec_muni), <span class="at">size=</span>.<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks,</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks))</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>resi <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Residence municipality"</span>)<span class="sc">+</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill=</span>resi_muni), <span class="at">size=</span>.<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks))</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>hosp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hospitalizations municipality"</span>)<span class="sc">+</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill=</span>hosp_muni), <span class="at">size=</span>.<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks,</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks))</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a><span class="co">#using the patchwork library, the plots can be displayed next to each other</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>(noti<span class="sc">+</span>infec)<span class="sc">/</span>(resi<span class="sc">+</span>hosp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_Plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Depending on the aim of the study, different variables can be important. For example, if your work aims to understand the dengue prevalence, the municipality of residence is the most suitable. However, if you need to evaluate the healthcare infrastructure, the municipality of hospitalisation could be more suitable.</p>
</section>
<section id="calculate-the-incidence" class="level3">
<h3 class="anchored" data-anchor-id="calculate-the-incidence"><em>Calculate the incidence</em></h3>
<p><img src="images/idea-03.png" class="img-fluid" width="23"> Sometimes, having the absolute values is helpful. But other times, the number of dengue cases are highly dependent on the number of inhabitants and then the incidence is used. The incidence describes how many dengue cases occurred per 100.000 inhabitants.</p>
<p>For this, the population data needs to be loaded from <a href="https://www.ibge.gov.br/estatisticas/sociais/populacao/9103-estimativas-de-populacao.html?edicao=31551&amp;t=resultados">IBGE</a> either manually or using the local function “get_br_pop_data” (instructions can be viewed in 0_DownloadData.md).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_br_pop_data</span>(<span class="dv">2015</span>, <span class="at">save=</span>F)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>allmuni <span class="ot">&lt;-</span>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(allmuni, pop_2015[<span class="fu">c</span>(<span class="st">"code_muni"</span>,<span class="st">"pop"</span>)], <span class="at">by=</span><span class="st">"code_muni"</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>allmuni<span class="sc">$</span>pop <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(allmuni<span class="sc">$</span>pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The incidence is then calculated by dividing the dengue cases by the population of each municipality and multiplicating it by 100.000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>allmuni<span class="sc">$</span>noti_inc <span class="ot">&lt;-</span> allmuni<span class="sc">$</span>noti_muni <span class="sc">/</span> allmuni<span class="sc">$</span>pop <span class="sc">*</span> <span class="dv">100000</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>allmuni<span class="sc">$</span>infec_inc <span class="ot">&lt;-</span> allmuni<span class="sc">$</span>infec_muni <span class="sc">/</span> allmuni<span class="sc">$</span>pop <span class="sc">*</span> <span class="dv">100000</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>allmuni<span class="sc">$</span>resi_inc <span class="ot">&lt;-</span> allmuni<span class="sc">$</span>resi_muni <span class="sc">/</span> allmuni<span class="sc">$</span>pop <span class="sc">*</span> <span class="dv">100000</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>allmuni<span class="sc">$</span>hosp_inc <span class="ot">&lt;-</span> allmuni<span class="sc">$</span>hosp_muni <span class="sc">/</span> allmuni<span class="sc">$</span>pop <span class="sc">*</span> <span class="dv">100000</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Population</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Population in Brazil"</span>)<span class="sc">+</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill =</span> pop), <span class="at">size =</span> .<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values=</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_Incidence-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Incidence</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>breaks2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="dv">25</span>,<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">250</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>noti_inc <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Incidence of dengue notifications in 2015"</span>)<span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill =</span> noti_inc), <span class="at">size =</span> .<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks2,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks2))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>infec_inc <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Incidence of probable dengue infections in 2015"</span>)<span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill =</span> infec_inc), <span class="at">size =</span> .<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks2,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks2))</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>resi_inc <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Incidence of residents with dengue in 2015"</span>)<span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill =</span> resi_inc), <span class="at">size =</span> .<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks2,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks2))</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>hosp_inc <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(allmuni) <span class="sc">+</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Incidence of dengue hospitalizations in 2015"</span>)<span class="sc">+</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>( <span class="fu">aes</span>(<span class="at">fill =</span> hosp_inc), <span class="at">size =</span> .<span class="dv">15</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_stepsn</span>(<span class="at">breaks =</span> breaks2,</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">colours =</span> cols,</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(breaks2))</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>(noti_inc<span class="sc">+</span>infec_inc)<span class="sc">/</span>(resi_inc<span class="sc">+</span>hosp_inc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="brazil_dengue_files/figure-html/Dengue_Incidence-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>HARMONIZE</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/harmonize-tools" target="_blank">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://harmonize-tools.github.io/" target="_blank">
      <i class="bi bi-wrench-adjustable-circle" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.harmonize-tools.org/" target="_blank">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>